<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Raphael JS</title>
	</head>
	<body style="background-color:#000">

		<canvas id="paper" style="background-color:#000;width:650px;float:left;height:400px;padding:0px;margin:20px"></canvas>

		<div id="dbg-info" style="width:200px;float:right"></div>
		
		<script src="lib/jquery-2.1.4.min.js" ></script>
		<script src="utils.js" ></script>
		<script src="Interval.js" ></script>
		<script src="angle-utils.js" ></script>
		<script src="Rect.js" ></script>
		<script src="canvas-utils.js" ></script>
		<script src="Shadow.js" ></script>
		<script src="Bubble.js" ></script>
		<script src="Bob.js" ></script>
		<script src="Segment.js" ></script>
		<script src="Door.js" ></script>
		<script src="Glass.js" ></script>
		<script src="Light.js" ></script>
		<script src="Path.js" ></script>
		<script src="Stair.js" ></script>
		<script src="keyboard-control.js" ></script>
		<script src="renderScene.js" ></script>
		<script src="PointCloud.js" ></script>
		<script src="random.js" ></script>
		<script src="Slope.js" ></script>
		<script>
					
			var paper_width = 650;
			var paper_height = 400;
						
						
			var paper = document.getElementById("paper");
			paper.width = paper_width;			
			paper.height = paper_height;			
					


			var num_points = 12;
			var donut = randomDonut(300,200, 115, 30, num_points);
			var innerCloud = donut.inner
			innerCloud.sort();	
			var outerCloud = donut.outer;
			outerCloud.sort();	
			
			
			
			var slopes = [];
			
			
			
			
			function addSlope(inner, outer, i){
				var arr = [];
				
				var j = i+1;
				if(j>=inner.points.length) j = 0; 
				arr.push(inner.points[i].x);
				arr.push(inner.points[i].y);
				
				
				arr.push(outer.points[i].x);
				arr.push(outer.points[i].y);
				
				
				arr.push(outer.points[j].x);
				arr.push(outer.points[j].y);
				
				
				arr.push(inner.points[j].x);
				arr.push(inner.points[j].y);
				
				return Slope.apply(new Slope(), arr);
			}
			
			for(var i=0;i<num_points;i++){
				slopes.push(addSlope(innerCloud,outerCloud,i));
			}
			
			
			
			
			
			var player = new Bob(225, 200, 10, 0);
			player.sightWidth=deg2rad(120);
			keyboardControl(player);

			
			
			function draw(){
			
//				pointCloud = randomPointCloud(num_points);
//				pointCloud.sort();
			
				
				var ctx = paper.getContext("2d");
				ctx.fillStyle="#000";
				ctx.fillRect(0,0, paper.width, paper.height);				

			ctx.strokeStyle="#0f0";
			ctx.fillStyle="rgba(0,0,0,0)";
			innerCloud.draw(paper);
			ctx.strokeStyle="#f00";
			outerCloud.draw(paper);


			for(var i=0;i<slopes.length;i++){
					slopes[i].draw(paper);
				
					if(slopes[i].inside(player.x, player.y)){
						slopes[i].check(player);
					}
				}
			
				// DRAWS PLAYER
				player.draw(paper);

				
				window.requestAnimationFrame(draw);
				
			
				
			}
			window.requestAnimationFrame(draw);
			//keyboardControl(player);






		</script>
	
	</body>
</html>
